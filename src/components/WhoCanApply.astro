---
import { withBase } from "../utils/paths";

const contextIntro =
  "Most of the funding we receive for this bursary comes in the form of zakaah. Zakaah funds must be allocated to specific categories of Muslims. We therefore prioritise Muslim students who qualify for zakaah support; however, all eligible students—Muslim and non-Muslim—are welcome to apply.";

const deadline = {
  date: "Sunday, 18 January 2026",
  cutoff: "Applications close sooner once 100 complete submissions are received.",
};

const cardBase =
  "flex h-full flex-col gap-4 rounded-2xl border px-6 py-6 shadow-[0_12px_45px_rgba(11,29,42,0.12)] transition-transform hover:-translate-y-1 focus-within:-translate-y-1";

const toneClasses = {
  primary: "border-[color-mix(in_lch,var(--brand-primary)_28%,white)] bg-[color-mix(in_lch,var(--brand-primary)_16%,white)] text-[#0b1d2a]",
  primarySoft: "border-[color-mix(in_lch,var(--brand-primary)_18%,white)] bg-[color-mix(in_lch,var(--brand-primary)_10%,white)] text-[#0b1d2a]",
  secondary: "border-[color-mix(in_lch,var(--brand-secondary)_36%,white)] bg-[color-mix(in_lch,var(--brand-secondary)_18%,white)] text-[#0b1d2a]",
  background: "border-[color-mix(in_lch,var(--brand-bg)_32%,white)] bg-[color-mix(in_lch,var(--brand-bg)_16%,white)] text-[#0b1d2a]",
  light: "border-white/60 bg-white/90 text-[#0b1d2a]",
};

const overviewCards = [
  {
    badge: "Zakaah funding",
    title: "Funding context & fairness",
    copy: contextIntro,
    highlightLabel: "Bottom line",
    highlight: "All qualifying students may apply, but zakaah-eligible Muslim applicants receive first consideration.",
    tone: "primary",
  },
  {
    badge: "Deadline",
    title: "Application cut-off",
    copy: deadline.cutoff,
    highlightLabel: "Final deadline",
    highlight: deadline.date,
    tone: "secondary",
  },
];

const detailCards = [
  {
    title: "Eligibility checklist",
    intro: "Make sure you satisfy every requirement before you begin your application.",
    items: [
      "You are an undergraduate student (no funding for postgraduate studies).",
      "You are a South African citizen.",
      "You reside in KwaZulu Natal. You may study elsewhere if the programme is unavailable locally, but KZN residency is required.",
    ],
    tone: "secondary",
  },
  {
    title: "During your bursary year",
    intro: "You’re expected to:",
    items: [
      "Volunteer at ILM-SA events throughout the academic year.",
      "Attend mentorship sessions and development programmes arranged by the organisation.",
      "Once you are employed, contribute a monthly donation back to ILM-SA, calculated according to your financial situation.",
    ],
    tone: "background",
  },
];

const expectationCards = [
  {
    title: "Media & visibility",
    copy:
      "We regularly publish respectful photographs and videos featuring bursary students on our platforms. Apply only if you and your guardians are comfortable with this level of visibility.",
    tone: "primary",
  },
  {
    title: "Competition & next steps",
    copy:
      "Funding is limited and demand is high. We cannot guarantee support for every applicant, so continue applying for other bursaries and backup options in parallel.",
    tone: "secondary",
  },
];
---
<section
  id="who-can-apply"
  class="relative mx-auto max-w-6xl px-4 py-16 scroll-mt-28"
>
  <div class="absolute inset-0 -z-10 rounded-3xl bg-[color-mix(in_lch,var(--brand-primary)_12%,white)] blur-3xl opacity-70"></div>

  <div class="relative overflow-hidden rounded-3xl border border-[color-mix(in_lch,var(--brand-primary)_20%,white)] bg-white/96 shadow-xl shadow-black/5">
    <div class="absolute left-0 top-0 h-full w-1 bg-[--brand-primary]/80 opacity-90"></div>

    <div class="relative px-6 py-10 md:px-10 lg:px-14">
      <header class="max-w-3xl space-y-3" data-animate>
        <span class="inline-flex items-center gap-2 rounded-full bg-[color-mix(in_lch,var(--brand-primary)_18%,white)] px-3 py-1 text-xs font-semibold uppercase tracking-[0.3em] text-[--brand-primary]">
          Read this first
        </span>
        <h2 class="text-3xl font-extrabold tracking-tight text-gray-900 md:text-4xl">
          WHAT YOU NEED TO KNOW BEFORE APPLYING
        </h2>
        <p class="text-base text-gray-600 md:text-lg">
          We want every applicant to understand the criteria, commitments, and expectations attached to ILM-SA bursary funding.
        </p>
      </header>

      <div class="mt-10 grid gap-6 lg:grid-cols-2" style="grid-auto-rows: minmax(0,1fr);">
        {overviewCards.map((card) => (
          <article
            class={`${cardBase} ${toneClasses[card.tone]}`}
            data-animate
          >
            <span class="inline-flex w-fit items-center gap-2 rounded-full bg-white/45 px-3 py-1 text-xs font-semibold uppercase tracking-[0.28em] text-gray-800">
              {card.badge}
            </span>
            <div class="space-y-3 text-sm text-gray-800 md:text-base">
              <h3 class="text-xl font-semibold text-gray-900">
                {card.title}
              </h3>
              <p>{card.copy}</p>
            </div>
            <div class="mt-auto rounded-xl border border-white/60 bg-white/70 px-4 py-3 text-sm font-semibold text-gray-900">
              <span class="text-xs font-semibold uppercase tracking-[0.32em] text-gray-500">{card.highlightLabel}</span>
              <span class="mt-1 block text-lg text-gray-900">{card.highlight}</span>
            </div>
          </article>
        ))}
      </div>

      <div
        class="mt-10 grid gap-6 md:grid-cols-2"
        style="grid-auto-rows: minmax(0, 1fr);"
      >
        {detailCards.map((section) => (
          <article
            class={`${cardBase} ${toneClasses[section.tone]}`}
            data-animate
          >
            <h3 class="text-lg font-semibold text-gray-900">
              {section.title}
            </h3>
            {section.intro && (
              <p class="text-sm text-gray-800 md:text-base">
                {section.intro}
              </p>
            )}
            <ul class="mt-2 space-y-3 text-sm text-gray-800 md:text-base">
              {section.items.map((item) => (
                <li class="flex gap-3">
                  <span class="mt-1 inline-block h-2.5 w-2.5 flex-shrink-0 rounded-full bg-[--brand-secondary]"></span>
                  <span>{item}</span>
                </li>
              ))}
            </ul>
          </article>
        ))}
      </div>

      <div
        class="mt-10 grid gap-6 md:grid-cols-2"
        style="grid-auto-rows: minmax(0, 1fr);"
      >
        {expectationCards.map((card) => (
          <article
            class={`${cardBase} ${toneClasses[card.tone]}`}
            data-animate
          >
            <h3 class="text-lg font-semibold text-gray-900">
              {card.title}
            </h3>
            {card.copy && (
              <p class="text-sm leading-6 text-gray-800 md:text-base">
                {card.copy}
              </p>
            )}
            {card.list && (
              <ul class="space-y-2 text-sm text-gray-800 md:text-base">
                {card.list.map((point) => (
                  <li class="flex gap-2">
                    <span class="mt-1 inline-flex h-2.5 w-2.5 flex-shrink-0 items-center justify-center">
                      <span class="h-2.5 w-2.5 rounded-full bg-[--brand-secondary]"></span>
                    </span>
                    <span>{point}</span>
                  </li>
                ))}
              </ul>
            )}
          </article>
        ))}
      </div>

      <aside
        class="mt-12 flex flex-col gap-4 rounded-2xl border border-[color-mix(in_lch,var(--brand-primary)_22%,white)] bg-[color-mix(in_lch,var(--brand-primary)_12%,white)] px-6 py-6 text-sm text-gray-900 shadow-sm md:flex-row md:items-center md:justify-between md:text-base"
        data-animate
      >
        <div class="flex items-center gap-3">
          <span class="inline-flex h-9 w-9 items-center justify-center rounded-full border border-[--brand-primary] bg-white text-[--brand-primary]">
            NEXT
          </span>
          <p>
            Ready to continue? Move on to the application form once you are confident you meet the requirements above and have your supporting documents lined up.
          </p>
        </div>
        <a
          href={withBase("/apply")}
          class="inline-flex items-center justify-center rounded-full border border-[--brand-secondary] px-5 py-2 text-sm font-semibold text-white shadow-[0_8px_20px_rgba(246,147,28,0.45)] transition hover:-translate-y-1 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[--brand-secondary]/80"
          style="background-color: var(--brand-secondary);"
        >
          Apply
        </a>
      </aside>
    </div>
  </div>
</section>

<script is:inline>
  const initWhoCanApplyAnimations = () => {
    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)');
    const animatedBlocks = document.querySelectorAll('#who-can-apply [data-animate]');

    if (!animatedBlocks.length) {
      return;
    }

    const prepareAnimations = () => {
      animatedBlocks.forEach((el, index) => {
        el.classList.add('is-preparing');
        el.style.transitionDelay = `${index * 60}ms`;
      });
    };

    const revealImmediately = () => {
      animatedBlocks.forEach((el) => {
        el.classList.remove('is-preparing');
        el.classList.add('is-visible');
      });
    };

    prepareAnimations();

    if (!('IntersectionObserver' in window)) {
      revealImmediately();
      return;
    }

    if (prefersReducedMotion.matches) {
      revealImmediately();
      return;
    }

    const observer = new IntersectionObserver(
      (entries, obs) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add('is-visible');
            entry.target.classList.remove('is-preparing');
            obs.unobserve(entry.target);
          }
        });
      },
      {
        rootMargin: '0px 0px -10% 0px',
        threshold: 0.25,
      },
    );

    animatedBlocks.forEach((el) => observer.observe(el));
  };

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initWhoCanApplyAnimations, { once: true });
  } else {
    initWhoCanApplyAnimations();
  }
</script>

<style>
  #who-can-apply [data-animate] {
    opacity: 1;
    transform: none;
  }

  #who-can-apply [data-animate].is-preparing {
    opacity: 0;
    transform: translateY(24px);
    transition:
      opacity 0.6s cubic-bezier(0.2, 0.65, 0.3, 1),
      transform 0.6s cubic-bezier(0.2, 0.65, 0.3, 1);
  }

  #who-can-apply [data-animate].is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  @media (prefers-reduced-motion: reduce) {
    #who-can-apply [data-animate] {
      opacity: 1;
      transform: none;
    }
  }
</style>

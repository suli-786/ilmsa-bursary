---
import { withBase } from "../utils/paths";

const contextIntro =
  "Most of the bursary funding we receive is in the form of zakaah. Zakaah funds must be allocated to specific categories of Muslims. We therefore prioritise Muslim applicants who qualify for zakaah assistance.  However, students who are not Muslim and Muslim students who do not qualify for zakaah assistance are welcome to apply.";

const deadline = {
  cutoff:
    "Applications close as soon as we receive 100 submissions or on the 18th of January – whichever occurs first.",
};

const cardBase =
  "flex h-full flex-col justify-between gap-5 rounded-2xl border px-7 py-8 shadow-[0_12px_45px_rgba(11,29,42,0.12)] transition-transform duration-300 hover:-translate-y-0.5 focus-within:-translate-y-0.5";

const toneClasses = {
  primary:
    "border-[color-mix(in_lch,var(--brand-primary)_28%,white)] bg-[color-mix(in_lch,var(--brand-primary)_16%,white)] text-[#0b1d2a]",
  secondary:
    "border-[color-mix(in_lch,var(--brand-secondary)_36%,white)] bg-[color-mix(in_lch,var(--brand-secondary)_18%,white)] text-[#0b1d2a]",
  background:
    "border-[color-mix(in_lch,var(--brand-bg)_32%,white)] bg-[color-mix(in_lch,var(--brand-bg)_16%,white)] text-[#0b1d2a]",
};

const headingCapsule =
  "inline-flex items-center justify-center rounded-full bg-white/55 px-4 py-1.5 text-[13px] font-semibold uppercase tracking-[0.22em] text-gray-900 shadow-sm backdrop-blur-sm";
---
<section
  id="who-can-apply"
  class="relative mx-auto max-w-6xl px-5 py-16 md:px-8 lg:px-10 scroll-mt-28"
>
  <!-- soft parallax glow -->
  <div
    class="pointer-events-none absolute inset-0 -z-10 rounded-3xl blur-3xl opacity-80"
    style="
      background:
        radial-gradient(60% 60% at 12% 12%, color-mix(in lch, var(--brand-primary) 18%, white) 0%, transparent 60%),
        radial-gradient(60% 60% at 88% 20%, color-mix(in lch, var(--brand-secondary) 16%, white) 0%, transparent 60%),
        radial-gradient(60% 60% at 50% 90%, color-mix(in lch, var(--brand-bg, #97cbc7) 14%, white) 0%, transparent 60%);
      transform: translateY(var(--parallax,0px));
      transition: transform .3s ease;
    "
  ></div>

  <div class="relative overflow-hidden rounded-3xl border border-[color-mix(in_lch,var(--brand-primary)_20%,white)] bg-white/96 shadow-xl shadow-black/5">
    <div class="absolute left-0 top-0 h-full w-1 bg-[--brand-primary]/80 opacity-90"></div>

    <div class="relative px-6 py-12 md:px-10 lg:px-14 lg:pb-16">
      <!-- Centered header -->
      <header class="mx-auto max-w-3xl text-center" data-animate>
        <span
          class="inline-flex items-center justify-center rounded-full px-4 py-1.5 text-[13px] font-semibold uppercase tracking-[0.22em] text-white shadow-sm backdrop-blur-sm"
          style="background-color: var(--brand-primary, #00a79d);"
        >
          Read this first
        </span>

        <h2 class="mt-4 text-balance font-extrabold tracking-tight text-gray-900"
            style="font-size: clamp(1.75rem, 3.5vw, 2.625rem); line-height: 1.15;">
          WHAT YOU NEED TO KNOW BEFORE APPLYING
        </h2>

        <p class="mx-auto mt-3 max-w-prose text-balance text-gray-700"
           style="font-size: clamp(1.05rem, 1.4vw, 1.1875rem); line-height: 1.65;">
          We want every applicant to understand the criteria, commitment and expectations attached to ILM-SA bursary funding.
        </p>
      </header>

      <!-- OVERVIEW -->
      <div class="mt-10 grid gap-7 lg:grid-cols-2" style="grid-auto-rows:minmax(0,1fr);">
        <article class={`${cardBase} ${toneClasses.primary}`} data-animate>
          <div>
            <div class="mb-3">
              <span class={headingCapsule}>Funding context & fairness</span>
            </div>
            <p class="text-gray-800" style="font-size: 1rem; line-height: 1.7;">
              {contextIntro}
            </p>
          </div>
        </article>

        <article class={`${cardBase} ${toneClasses.secondary}`} data-animate>
          <div>
            <div class="mb-3">
              <span class={headingCapsule}>Application cut-off</span>
            </div>
            <p class="text-gray-800" style="font-size: 1rem; line-height: 1.7;">
              {deadline.cutoff}
            </p>
          </div>

          <!-- Bottom line -->
          <div
            class="mt-5 rounded-xl border border-white/60 bg-white/75 px-4 py-3 text-center font-semibold text-gray-900 shadow-sm"
            style="font-size: clamp(.98rem, 1.2vw, 1.0625rem); line-height: 1.35;"
            data-animate
          >
            BOTTOM LINE: Apply as soon as possible!
          </div>
        </article>
      </div>

      <!-- DETAILS -->
      <div class="mt-10 grid gap-7 md:grid-cols-2" style="grid-auto-rows:minmax(0,1fr);">
        <article class={`${cardBase} ${toneClasses.secondary}`} data-animate>
          <div>
            <div class="mb-3">
              <span class={headingCapsule}>Eligibility checklist</span>
            </div>
            <ul
              class="marker:text-[--brand-secondary] list-disc text-gray-800"
              style="padding-left: 1.15rem; font-size: 1rem; line-height: 1.75;"
            >
              <li class="mb-1.5">You are an undergraduate student (no funding for postgraduate studies).</li>
              <li class="mb-1.5">You are a South African citizen.</li>
              <li>You reside in KwaZulu Natal. You may study elsewhere if the programme is inaccessible locally, but KZN residency is required.</li>
            </ul>
          </div>
        </article>

        <article class={`${cardBase} ${toneClasses.background}`} data-animate>
          <div>
            <div class="mb-3">
              <span class={headingCapsule}>If you are accepted into our programme</span>
            </div>
            <ul
              class="marker:text-[--brand-secondary] list-disc text-gray-800"
              style="padding-left: 1.15rem; font-size: 1rem; line-height: 1.75;"
            >
              <li class="mb-1.5">Volunteer at ILM-SA events throughout the academic year.</li>
              <li class="mb-1.5">Attend mentorship sessions and development programmes arranged by the organisation.</li>
              <li>Donate to ILM-SA on a monthly basis once you are employed – the specific amount will depend on your financial situation.</li>
            </ul>
          </div>
        </article>
      </div>

      <!-- EXPECTATIONS -->
      <div class="mt-10 grid gap-7 md:grid-cols-2" style="grid-auto-rows:minmax(0,1fr);">
        <article class={`${cardBase} ${toneClasses.primary}`} data-animate>
          <div>
            <div class="mb-3">
              <span class={headingCapsule}>Media & visibility</span>
            </div>
            <p class="text-gray-800" style="font-size: 1rem; line-height: 1.7;">
              We regularly publish photographs and videos featuring our bursary students on our marketing platforms. This is done in the most respectful of ways. Apply only if you and your guardians are comfortable with this level of visibility.
            </p>
          </div>
        </article>

        <article class={`${cardBase} ${toneClasses.secondary}`} data-animate>
          <div>
            <div class="mb-3">
              <span class={headingCapsule}>Apply elsewhere too</span>
            </div>
            <p class="text-gray-800" style="font-size: 1rem; line-height: 1.7;">
              Funding is limited and demand is high. We cannot guarantee support for every applicant, so please continue applying for other bursaries.
            </p>
          </div>
        </article>
      </div>

      <!-- APPLY BUTTON -->
      <div class="mt-12 flex justify-center" data-animate>
        <a
          href={withBase("/apply")}
          class="inline-flex items-center justify-center rounded-full px-8 py-3 font-semibold text-white shadow-[0_8px_20px_rgba(246,147,28,0.45)] transition will-change-transform hover:-translate-y-[2px] focus-visible:outline-none focus-visible:ring-2"
          style="background-color: var(--brand-secondary, #f7921c); border: 1px solid var(--brand-secondary, #f7921c); font-size: clamp(1rem, 1.3vw, 1.0625rem);"
        >
          Apply
        </a>
      </div>
    </div>
  </div>
</section>

<script is:inline>
  // Scroll reveal + subtle parallax (typography-friendly)
  (() => {
    const root = document.getElementById("who-can-apply");
    if (!root) return;

    const prefersReduced = window.matchMedia("(prefers-reduced-motion: reduce)").matches;
    const animated = Array.from(root.querySelectorAll("[data-animate]"));

    animated.forEach((el, i) => {
      el.classList.add("sr-prep");
      el.style.setProperty("--sr-delay", `${Math.min(i * 70, 560)}ms`);
    });

    const bg = root.querySelector(":scope > div.pointer-events-none");
    const onScroll = () => {
      if (!bg) return;
      const rect = root.getBoundingClientRect();
      const viewportH = window.innerHeight || 800;
      const progress = Math.max(-rect.top, 0) / (rect.height + viewportH);
      bg.style.setProperty("--parallax", `${progress * 24 - 12}px`);
    };

    if (prefersReduced || !("IntersectionObserver" in window)) {
      animated.forEach((el) => el.classList.add("sr-show"));
      onScroll();
      return;
    }

    const io = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add("sr-show");
          io.unobserve(entry.target);
        }
      });
    }, { rootMargin: "0px 0px -10% 0px", threshold: 0.15 });

    animated.forEach((el) => io.observe(el));
    onScroll();
    window.addEventListener("scroll", onScroll, { passive: true });
  })();
</script>

<style>
  :root {
    --font-sans: "Inter var", "Inter", ui-sans-serif, system-ui, -apple-system, "Segoe UI",
                 Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji",
                 "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
  }

  #who-can-apply {
    font-family: var(--font-sans);
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    font-kerning: normal;
    font-variant-numeric: tabular-nums;
    text-rendering: optimizeLegibility;
  }

  /* Scroll reveal states */
  #who-can-apply [data-animate].sr-prep {
    opacity: 0;
    transform: translateY(22px) scale(.985);
    transition:
      opacity .70s cubic-bezier(.2,.65,.3,1) var(--sr-delay, 0ms),
      transform .70s cubic-bezier(.2,.65,.3,1) var(--sr-delay, 0ms);
  }
  #who-can-apply [data-animate].sr-show {
    opacity: 1;
    transform: translateY(0) scale(1);
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    #who-can-apply [data-animate].sr-prep,
    #who-can-apply [data-animate].sr-show {
      opacity: 1 !important;
      transform: none !important;
      transition: none !important;
    }
  }

  /* Card focus outline for keyboard nav */
  #who-can-apply article:focus-within {
    outline: 2px solid color-mix(in lch, var(--brand-secondary) 40%, white);
    outline-offset: 2px;
  }

  /* Bullet polish */
  #who-can-apply ul {
    list-style-position: outside;
  }
  #who-can-apply ul li::marker {
    font-size: .9em;
  }
</style>
